# ๐ ะะพะปะฝะฐั ะธะฝััััะบัะธั: STM32 โ ESP32 โ Node.js ัะตัะฒะตั

## ๐ ะะณะปะฐะฒะปะตะฝะธะต
1. [ะงัะพ ะฝัะถะฝะพ](#ััะพ-ะฝัะถะฝะพ)
2. [ะกัะตะผะฐ ะฟะพะดะบะปััะตะฝะธั](#ััะตะผะฐ-ะฟะพะดะบะปััะตะฝะธั)
3. [ะะฐัััะพะนะบะฐ Node.js ัะตัะฒะตัะฐ](#1-ะฝะฐัััะพะนะบะฐ-nodejs-ัะตัะฒะตัะฐ)
4. [ะัะพัะธะฒะบะฐ ESP32](#2-ะฟัะพัะธะฒะบะฐ-esp32)
5. [ะัะพัะธะฒะบะฐ STM32](#3-ะฟัะพัะธะฒะบะฐ-stm32)
6. [ะะฐะฟััะบ ะธ ัะตััะธัะพะฒะฐะฝะธะต](#4-ะทะฐะฟััะบ-ะธ-ัะตััะธัะพะฒะฐะฝะธะต)

---

## ๐ง ะงัะพ ะฝัะถะฝะพ

### ะะตะปะตะทะพ
- โ **STM32F411CEU6 Black Pill** (ั ะฒะฐั ะตััั)
- โ **ESP32-WROOM-32D** (ั ะฒะฐั ะตััั)
- โ **ST-Link V2** (ะฟัะพะณัะฐะผะผะฐัะพั ะดะปั STM32)
- โ **4 ะบะฝะพะฟะบะธ** (ัะถะต ะฟะพะดะบะปััะตะฝั)
- โ **4 LED** (ัะถะต ะฟะพะดะบะปััะตะฝั)
- โ **TB6612FNG ะดัะฐะนะฒะตัั** (2 ัั, ัะถะต ะฟะพะดะบะปััะตะฝั)
- ๐ฆ **3 ะฟัะพะฒะพะดะฐ** (GND, TX, RX)
- ๐ฆ **2 USB ะบะฐะฑะตะปั** (ะดะปั STM32 ะธ ESP32)

### ะกะพัั
- โ **PlatformIO** (ะดะปั STM32)
- ๐ฆ **Arduino IDE 2.x** (ะดะปั ESP32)
- ๐ฆ **Node.js** (ะดะปั ัะตัะฒะตัะฐ)

---

## ๐ ะกัะตะผะฐ ะฟะพะดะบะปััะตะฝะธั

### STM32 Black Pill โ ESP32-WROOM-32D

```
โโโโโโโโโโโโโโโโโโโโโโโโ           โโโโโโโโโโโโโโโโโโโโโโโโ
โ  STM32 Black Pill    โ           โ  ESP32-WROOM-32D     โ
โ  (STM32F411CEU6)     โ           โ  (Wi-Fi + BT + BLE)  โ
โโโโโโโโโโโโโโโโโโโโโโโโค           โโโโโโโโโโโโโโโโโโโโโโโโค
โ                      โ           โ                      โ
โ  PA9  (UART1 TX) โโโโโผโโโโโโโโโโโโผโโโโ GPIO3 (RX)      โ
โ  PA10 (UART1 RX) โโโโโผโโโโโโโโโโโโผโโโโ GPIO1 (TX)      โ
โ  GND โโโโโโโโโโโโโโโโโผโโโโโโโโโโโโผโโโโ GND             โ
โ                      โ           โ                      โ
โ  USB/ST-Link         โ           โ  USB (ะฟะธัะฐะฝะธะต)       โ
โโโโโโโโโโโโโโโโโโโโโโโโ           โโโโโโโโโโโโโโโโโโโโโโโโ
       โ                                     โ
       โ                                     โ
   ะัะพะณัะฐะผะผะธัะพะฒะฐะฝะธะต                    ะัะพะณัะฐะผะผะธัะพะฒะฐะฝะธะต
   ัะตัะตะท ST-Link                       ัะตัะตะท USB


                         โ WiFi โ

              โโโโโโโโโโโโโโโโโโโโโโโโ
              โ  Node.js Server      โ
              โ  (ะะฐั ะบะพะผะฟัััะตั)     โ
              โ  Port: 3000          โ
              โโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะฐะถะฝัะต ะทะฐะผะตัะฐะฝะธั:
- โ๏ธ **TX โ RX, RX โ TX** (ะฟะตัะตะบััััะฝะพะต ะฟะพะดะบะปััะตะฝะธะต)
- โ๏ธ **ะะฑัะธะน GND ะพะฑัะทะฐัะตะปะตะฝ!**
- โ๏ธ **ะะ ัะพะตะดะธะฝััั VCC/3V3 ะผะตะถะดั ะฟะปะฐัะฐะผะธ**
- โ๏ธ **ESP32 ะธ STM32 ะฟะธัะฐัััั ะพัะดะตะปัะฝะพ** (ะบะฐะถะดัะน ะพั ัะฒะพะตะณะพ USB)

---

## 1๏ธโฃ ะะฐัััะพะนะบะฐ Node.js ัะตัะฒะตัะฐ

### ะฃััะฐะฝะพะฒะบะฐ Node.js (ะตัะปะธ ะฝะตั)

**MacOS:**
```bash
brew install node
```

**Linux:**
```bash
sudo apt install nodejs npm
```

**Windows:**
ะกะบะฐัะฐัั ั https://nodejs.org

### ะะฐะฟััะบ ัะตัะฒะตัะฐ

```bash
# ะะตัะตะนัะธ ะฒ ะฟะฐะฟะบั ั ัะตัะฒะตัะพะผ
cd ~/Documents/PlatformIO/Projects/STM32_Core/server

# ะฃััะฐะฝะพะฒะธัั ะทะฐะฒะธัะธะผะพััะธ
npm install

# ะะฐะฟัััะธัั ัะตัะฒะตั
npm start
```

**ะะถะธะดะฐะตะผัะน ะฒัะฒะพะด:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ STM32 Robot Control Server
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โ Server running on: http://localhost:3000
๐ก Network address: http://192.168.1.100:3000

๐ Waiting for data from ESP32...
```

### ะฃะทะฝะฐัั IP ะฐะดัะตั ะบะพะผะฟัััะตัะฐ

**MacOS/Linux:**
```bash
ifconfig | grep "inet " | grep -v 127.0.0.1
```

**Windows:**
```cmd
ipconfig | findstr IPv4
```

**ะะฐะฟะธัะธัะต IP ะฐะดัะตั** (ะฝะฐะฟัะธะผะตั, `192.168.1.100`) - ะพะฝ ะฟะพะฝะฐะดะพะฑะธััั ะดะปั ESP32!

---

## 2๏ธโฃ ะัะพัะธะฒะบะฐ ESP32

### ะฃััะฐะฝะพะฒะบะฐ Arduino IDE

1. ะกะบะฐัะฐัั Arduino IDE 2.x: https://www.arduino.cc/en/software
2. ะฃััะฐะฝะพะฒะธัั

### ะะพะฑะฐะฒะปะตะฝะธะต ะฟะพะดะดะตัะถะบะธ ESP32

1. **File โ Preferences**
2. **Additional Boards Manager URLs:**
   ```
   https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json
   ```
3. **Tools โ Board โ Boards Manager**
4. ะะฐะนัะธ **"esp32"** โ Install

### ะะฐัััะพะนะบะฐ ะฟะปะฐัั

**Tools โ Board โ esp32 โ ESP32 Dev Module**

**ะะฐัััะพะนะบะธ:**
- Upload Speed: `115200`
- CPU Frequency: `240MHz`
- Flash Frequency: `80MHz`
- Flash Mode: `QIO`
- Flash Size: `4MB`
- Partition Scheme: `Default 4MB with spiffs`
- Core Debug Level: `None`
- Port: ะัะฑัะฐัั ะฟะพัั ESP32 (ะฝะฐะฟัะธะผะตั `/dev/cu.usbserial-XXX`)

### ะฃััะฐะฝะพะฒะบะฐ ะฑะธะฑะปะธะพัะตะบ

**Tools โ Manage Libraries...**

ะฃััะฐะฝะพะฒะธัั:
- **ArduinoJson** (ะฒะตััะธั 6.x)

### ะัะบัััะธะต ะบะพะดะฐ

1. ะัะบัััั ัะฐะนะป:
   ```
   ~/Documents/PlatformIO/Projects/STM32_Core/esp32/esp32_wifi_bridge.ino
   ```

2. **ะะะะะะะขะฌ ะฝะฐัััะพะนะบะธ WiFi ะธ ัะตัะฒะตัะฐ:**

   ```cpp
   const char* WIFI_SSID = "YOUR_WIFI_SSID";        // โ ะะะฏ ะะะจะะ WiFi
   const char* WIFI_PASSWORD = "YOUR_WIFI_PASSWORD"; // โ ะะะะะะฌ
   const char* SERVER_URL = "http://192.168.1.100:3000/data";  // โ IP ะะะจะะะ ะะะะะฌะฎะขะะะ
   ```

### ะัะพัะธะฒะบะฐ ESP32

1. ะะพะดะบะปััะธัั ESP32 ะบ USB
2. ะัะฑัะฐัั ะฟัะฐะฒะธะปัะฝัะน ะฟะพัั ะฒ **Tools โ Port**
3. ะะฐะถะฐัั **Upload** (ัััะตะปะบะฐ โ)

**ะะถะธะดะฐะตะผัะน ะฒัะฒะพะด ะฒ Serial Monitor:**
```
=================================
ESP32 WiFi Bridge ะดะปั STM32
=================================

[WiFi] ะะพะดะบะปััะตะฝะธะต ะบ YourWiFi...
[WiFi] โ ะะพะดะบะปััะตะฝะพ!
[WiFi] IP ะฐะดัะตั: 192.168.1.150
[WiFi] ะกะตัะฒะตั: http://192.168.1.100:3000/data
```

---

## 3๏ธโฃ ะัะพัะธะฒะบะฐ STM32

### ะะพะผะฟะธะปััะธั ะธ ะทะฐะณััะทะบะฐ

```bash
# ะะตัะตะนัะธ ะฒ ะฟะฐะฟะบั ะฟัะพะตะบัะฐ
cd ~/Documents/PlatformIO/Projects/STM32_Core

# ะกะพะฑัะฐัั ะฟัะพะตะบั
platformio run

# ะะฐะณััะทะธัั ะฝะฐ STM32
platformio run --target upload
```

**ะะปััะตัะฝะฐัะธะฒะฐ (VS Code):**
- ะะฐะถะฐัั ะบะฝะพะฟะบั **"Upload"** ะฒ ะฝะธะถะฝะตะน ะฟะฐะฝะตะปะธ PlatformIO

### ะัะพะฒะตัะบะฐ ัะฐะฑะพัั

ะะพัะปะต ะฟัะพัะธะฒะบะธ LED ะฝะฐ PC13 ะดะพะปะถะตะฝ ะผะธะณะฐัั 1 ัะฐะท ะฒ ัะตะบัะฝะดั (ัะธััะตะผะฐ ัะฐะฑะพัะฐะตั).

---

## 4๏ธโฃ ะะฐะฟััะบ ะธ ัะตััะธัะพะฒะฐะฝะธะต

### ะะพััะดะพะบ ะทะฐะฟััะบะฐ

1. โ **ะะฐะฟัััะธัั Node.js ัะตัะฒะตั** (ะดะพะปะถะตะฝ ะฑััั ะทะฐะฟััะตะฝ ะฟะตัะฒัะผ)
   ```bash
   cd ~/Documents/PlatformIO/Projects/STM32_Core/server
   npm start
   ```

2. โ **ะะพะดะบะปััะธัั ะธ ะฟัะพัะธัั ESP32** (ะดะพะปะถะตะฝ ะฟะพะดะบะปััะธัััั ะบ WiFi)

3. โ **ะะพะดะบะปััะธัั ะธ ะฟัะพัะธัั STM32** (ะฝะฐัะฝัั ะพัะฟัะฐะฒะปััั ะดะฐะฝะฝัะต)

4. โ **ะคะธะทะธัะตัะบะธ ัะพะตะดะธะฝะธัั ะฟัะพะฒะพะดะฐ:**
   - STM32 PA9 โ ESP32 GPIO3
   - STM32 PA10 โ ESP32 GPIO1
   - STM32 GND โ ESP32 GND

### ะขะตัั 1: ะะฝะพะฟะบะฐ โ ะะพัะพั โ ะขะตะปะตะผะตััะธั

1. **ะะฐะถะฐัั ะบะฝะพะฟะบั BTN_0 ะฝะฐ STM32**
2. **ะะถะธะดะฐะตะผัะต ัะตะทัะปััะฐัั:**

   **STM32 (printf):**
   ```
   BTN_0 pressed โ Motor 0 ON (70%) + LED ON
   ```

   **ESP32 (Serial Monitor):**
   ```
   [STM32] ะะพะปััะตะฝะพ: {"button":0,"state":"pressed"}
   [HTTP] ะัะฟัะฐะฒะบะฐ ะฝะฐ ัะตัะฒะตั: {"button":0,"state":"pressed"}
   [HTTP] โ ะะพะด ะพัะฒะตัะฐ: 200
   ```

   **Node.js ัะตัะฒะตั:**
   ```
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   [2026-02-17T14:30:45.123Z] ๐ฆ ะะพะปััะตะฝั ะดะฐะฝะฝัะต ะพั STM32:
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   {
     "button": 0,
     "state": "pressed"
   }

   ๐ ะะฝะพะฟะบะฐ 0: pressed
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   ```

3. **ะัะฟัััะธัั ะบะฝะพะฟะบั BTN_0**

   **Node.js ัะตัะฒะตั:**
   ```
   {
     "button": 0,
     "state": "released"
   }

   ๐ ะะฝะพะฟะบะฐ 0: released

   {
     "motor": 0,
     "direction": "forward",
     "speed": 0
   }

   ๐ง ะะพัะพั 0:
      ะะฐะฟัะฐะฒะปะตะฝะธะต: forward
      ะกะบะพัะพััั: 0%
   ```

### ะขะตัั 2: ะัะพะฒะตัะบะฐ ะฒัะตั ะบะฝะพะฟะพะบ

ะะฐะถะฐัั ะฟะพ ะพัะตัะตะดะธ BTN_0, BTN_1, BTN_2, BTN_3 - ะบะฐะถะดะฐั ะดะพะปะถะฝะฐ:
- โ ะะบะปััะธัั ัะฒะพะน ะผะพัะพั
- โ ะะบะปััะธัั ัะฒะพะน LED
- โ ะัะฟัะฐะฒะธัั ะดะฐะฝะฝัะต ะฝะฐ ัะตัะฒะตั

---

## ๐ ะัะพะฑะปะตะผั ะธ ัะตัะตะฝะธั

### ะัะพะฑะปะตะผะฐ: ESP32 ะฝะต ะฟะพะดะบะปััะฐะตััั ะบ WiFi

**ะัะธัะธะฝั:**
- ะะตะฟัะฐะฒะธะปัะฝัะน SSID ะธะปะธ ะฟะฐัะพะปั
- WiFi 5 GHz (ESP32 ัะฐะฑะพัะฐะตั ัะพะปัะบะพ ั 2.4 GHz)
- ะกะปะฐะฑัะน ัะธะณะฝะฐะป WiFi

**ะะตัะตะฝะธะต:**
1. ะัะพะฒะตัะธัั SSID ะธ ะฟะฐัะพะปั ะฒ ะบะพะดะต ESP32
2. ะฃะฑะตะดะธัััั ััะพ ัะพััะตั ะฝะฐ 2.4 GHz
3. ะะพะดะฝะตััะธ ESP32 ะฑะปะธะถะต ะบ ัะพััะตัั

### ะัะพะฑะปะตะผะฐ: ESP32 ะฝะต ะฟะพะปััะฐะตั ะดะฐะฝะฝัะต ะพั STM32

**ะัะธัะธะฝั:**
- ะะตะฟัะฐะฒะธะปัะฝะพะต ะฟะพะดะบะปััะตะฝะธะต ะฟัะพะฒะพะดะพะฒ
- ะะฐะทะฝัะน baud rate
- ะะตั ะพะฑัะตะณะพ GND

**ะะตัะตะฝะธะต:**
1. ะัะพะฒะตัะธัั: STM32 PA9 โ ESP32 GPIO3 (RX)
2. ะัะพะฒะตัะธัั: STM32 PA10 โ ESP32 GPIO1 (TX)
3. ะัะพะฒะตัะธัั: GND ัะพะตะดะธะฝัะฝ
4. ะฃะฑะตะดะธัััั ััะพ baud rate = 115200 ะฒะตะทะดะต

### ะัะพะฑะปะตะผะฐ: ะกะตัะฒะตั ะฝะต ะฟะพะปััะฐะตั ะดะฐะฝะฝัะต

**ะัะธัะธะฝั:**
- ะะตะฟัะฐะฒะธะปัะฝัะน IP ะฐะดัะตั ะฒ ะบะพะดะต ESP32
- Firewall ะฑะปะพะบะธััะตั ะฟะพัั 3000
- ESP32 ะธ ะบะพะผะฟัััะตั ะฒ ัะฐะทะฝัั ัะตััั

**ะะตัะตะฝะธะต:**
1. ะฃะทะฝะฐัั IP ะบะพะผะฟัััะตัะฐ: `ifconfig` (Mac) ะธะปะธ `ipconfig` (Win)
2. ะะฑะฝะพะฒะธัั `SERVER_URL` ะฒ ะบะพะดะต ESP32
3. ะัะพะฒะตัะธัั firewall (ัะฐะทัะตัะธัั ะฟะพัั 3000)
4. ะฃะฑะตะดะธัััั ััะพ ESP32 ะธ ะบะพะผะฟัััะตั ะฒ ะพะดะฝะพะน WiFi ัะตัะธ

### ะัะพะฑะปะตะผะฐ: ะะฐะฝะฝัะต ะฟัะธัะพะดัั ะบัะฐะบะพะทัะฑัะฐะผะธ

**ะัะธัะธะฝั:**
- ะะตะฟัะฐะฒะธะปัะฝัะน baud rate
- ะะพะผะตัะธ ะฝะฐ ะฟัะพะฒะพะดะฐั

**ะะตัะตะฝะธะต:**
1. ะัะพะฒะตัะธัั ััะพ ะฒะตะทะดะต baud rate = 115200
2. ะัะฟะพะปัะทะพะฒะฐัั ะบะพัะพัะบะธะต ะฟัะพะฒะพะดะฐ (ะดะพ 30 ัะผ)
3. ะัะพะฒะตัะธัั ะบะฐัะตััะฒะพ ัะพะตะดะธะฝะตะฝะธะน

---

## ๐ ะคะพัะผะฐั ะดะฐะฝะฝัั JSON

### ะะฝะพะฟะบะฐ ะฝะฐะถะฐัะฐ/ะพัะฟััะตะฝะฐ
```json
{"button": 0, "state": "pressed"}
{"button": 0, "state": "released"}
```

### ะะพัะพั ะฒะบะปััะตะฝ/ะฒัะบะปััะตะฝ
```json
{"motor": 0, "direction": "forward", "speed": 75}
{"motor": 0, "direction": "forward", "speed": 0}
```

### ะัะต ะผะพัะพัั (ะฑัะดััะตะต)
```json
{
  "motors": [
    {"state": "running", "speed": 80},
    {"state": "stopped", "speed": 0},
    {"state": "running", "speed": 60},
    {"state": "stopped", "speed": 0}
  ]
}
```

---

## ๐ฏ ะกะปะตะดัััะธะต ัะฐะณะธ

ะะพัะปะต ััะฟะตัะฝะพะณะพ ะทะฐะฟััะบะฐ ะผะพะถะฝะพ ะดะพะฑะฐะฒะธัั:

- [ ] ะะตะฑ-ะธะฝัะตััะตะนั ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะผะพัะพัะฐะผะธ
- [ ] ะัะฐัะธะบะธ RPM (ะตัะปะธ ะฟะพะดะบะปััะธัั ัะฝะบะพะดะตัั)
- [ ] ะฃะฟัะฐะฒะปะตะฝะธะต ั ัะตัะฒะตัะฐ (Server โ ESP32 โ STM32)
- [ ] ะกะพััะฐะฝะตะฝะธะต ะดะฐะฝะฝัั ะฒ ะฑะฐะทั
- [ ] ะะพะฑะธะปัะฝะพะต ะฟัะธะปะพะถะตะฝะธะต
- [ ] ะะฒัะพะฝะพะผะฝะพะต ัะฟัะฐะฒะปะตะฝะธะต (AI?)

---

## ๐ ะงะตะบะปะธัั ะดะปั ะฑััััะพะณะพ ะทะฐะฟััะบะฐ

### ะะพะดะณะพัะพะฒะบะฐ
- [ ] Node.js ัััะฐะฝะพะฒะปะตะฝ
- [ ] Arduino IDE ัััะฐะฝะพะฒะปะตะฝ (ั ะฟะพะดะดะตัะถะบะพะน ESP32)
- [ ] PlatformIO ัะฐะฑะพัะฐะตั
- [ ] ะฃะทะฝะฐะป IP ะฐะดัะตั ะบะพะผะฟัััะตัะฐ

### ะัะพัะธะฒะบะฐ
- [ ] ะกะตัะฒะตั ะทะฐะฟััะตะฝ (`npm start`)
- [ ] ESP32 ะฟัะพัะธั (ะธะทะผะตะฝะตะฝั SSID, ะฟะฐัะพะปั, IP)
- [ ] STM32 ะฟัะพัะธั (USE_UART_TELEMETRY ะฒะบะปััะตะฝ)

### ะกะพะตะดะธะฝะตะฝะธั
- [ ] STM32 PA9 โ ESP32 GPIO3 (RX)
- [ ] STM32 PA10 โ ESP32 GPIO1 (TX)
- [ ] STM32 GND โ ESP32 GND
- [ ] ะะฑะฐ ััััะพะนััะฒะฐ ะฟะพะดะบะปััะตะฝั ะบ USB

### ะัะพะฒะตัะบะฐ
- [ ] ะกะตัะฒะตั ะฟะพะบะฐะทัะฒะฐะตั "Running"
- [ ] ESP32 ะฟะพะดะบะปััะธะปัั ะบ WiFi
- [ ] ะะฐะถะฐัะธะต ะบะฝะพะฟะบะธ ะพัะฟัะฐะฒะปัะตั ะดะฐะฝะฝัะต ะฝะฐ ัะตัะฒะตั

---

## ๐ ะะพะผะพัั

ะัะปะธ ััะพ-ัะพ ะฝะต ัะฐะฑะพัะฐะตั:

1. **ะัะพะฒะตัะธัั Serial Monitor ESP32** (Tools โ Serial Monitor, 115200 baud)
2. **ะัะพะฒะตัะธัั ะบะพะฝัะพะปั Node.js ัะตัะฒะตัะฐ**
3. **ะัะพะฒะตัะธัั printf STM32** (ะตัะปะธ ะฝะฐัััะพะตะฝ)
4. **ะัะพะฒะตัะธัั ัะธะทะธัะตัะบะธะต ัะพะตะดะธะฝะตะฝะธั**

**ะฃะดะฐัะธ! ๐**
