# Node.js Server –¥–ª—è STM32 Robot

–°–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä–∏—ë–º–∞ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–æ–±–æ—Ç–æ–º STM32 —á–µ—Ä–µ–∑ ESP8266.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd server
npm install
```

### 2. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
npm start
```

–ò–ª–∏ –¥–ª—è –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö:

```bash
npm run dev
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `http://localhost:3000`

## üì° API Endpoints

### GET /
–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–µ—Ä–≤–µ—Ä–µ

### POST /data
–ü—Ä–∏—ë–º —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ –æ—Ç STM32

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "button": 0,
  "state": "pressed"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "OK",
  "message": "Data received",
  "timestamp": "2026-02-17T12:34:56.789Z"
}
```

### GET /status
–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "running",
  "uptime": 123.456,
  "timestamp": "2026-02-17T12:34:56.789Z",
  "port": 3000
}
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç

–í —Ñ–∞–π–ª–µ `server.js`:
```javascript
const PORT = 3000; // –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω—É–∂–Ω—ã–π –ø–æ—Ä—Ç
```

### –£–∑–Ω–∞—Ç—å IP –∞–¥—Ä–µ—Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞

**MacOS/Linux:**
```bash
ifconfig | grep "inet "
```

**Windows:**
```cmd
ipconfig
```

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç IP –≤ –∫–æ–¥–µ ESP8266 (`SERVER_URL`).

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ ESP

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é curl

```bash
# –¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏
curl -X POST http://localhost:3000/data \
  -H "Content-Type: application/json" \
  -d '{"button": 0, "state": "pressed"}'

# –¢–µ—Å—Ç –º–æ—Ç–æ—Ä–∞
curl -X POST http://localhost:3000/data \
  -H "Content-Type: application/json" \
  -d '{"motor": 0, "direction": "forward", "speed": 75}'
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Postman

1. Method: POST
2. URL: `http://localhost:3000/data`
3. Headers: `Content-Type: application/json`
4. Body (raw JSON):
```json
{
  "button": 0,
  "state": "pressed"
}
```

## üìä –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö

### –ö–Ω–æ–ø–∫–∞
```json
{
  "button": 0,
  "state": "pressed"
}
```

### –ú–æ—Ç–æ—Ä
```json
{
  "motor": 0,
  "direction": "forward",
  "speed": 75
}
```

### –í—Å–µ –º–æ—Ç–æ—Ä—ã
```json
{
  "motors": [
    {"state": "running", "speed": 80},
    {"state": "running", "speed": 80},
    {"state": "stopped", "speed": 0},
    {"state": "stopped", "speed": 0}
  ]
}
```

### RPM (—ç–Ω–∫–æ–¥–µ—Ä—ã)
```json
{
  "motor": 0,
  "rpm": 325.5
}
```

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
server/
‚îú‚îÄ‚îÄ server.js      # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ package.json   # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ README.md      # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö endpoint'–æ–≤

```javascript
app.post('/command', (req, res) => {
    // –í–∞—à –∫–æ–¥ –∑–¥–µ—Å—å
    res.json({ status: 'OK' });
});
```

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü–æ—Ä—Ç –∑–∞–Ω—è—Ç
```
Error: listen EADDRINUSE: address already in use :::3000
```

**–†–µ—à–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç –≤ `server.js` –∏–ª–∏ –∑–∞–∫—Ä–æ–π—Ç–µ –¥—Ä—É–≥–æ–π –ø—Ä–æ—Ü–µ—Å—Å:
```bash
# –ù–∞–π—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ –ø–æ—Ä—Ç—É 3000
lsof -i :3000

# –£–±–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å
kill -9 <PID>
```

### Firewall –±–ª–æ–∫–∏—Ä—É–µ—Ç
**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑—Ä–µ—à–∏—Ç–µ –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–∞ –ø–æ—Ä—Ç 3000

**MacOS:**
```bash
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --add node
```

**Windows:**
- Settings ‚Üí Firewall ‚Üí Allow app ‚Üí Node.js

## üîú –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] WebSocket –¥–ª—è —Ä–µ–∞–ª-—Ç–∞–π–º —Å–≤—è–∑–∏
- [ ] –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑—É (SQLite/MongoDB)
- [ ] –ì—Ä–∞—Ñ–∏–∫–∏ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏
- [ ] –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- [ ] HTTPS –ø–æ–¥–¥–µ—Ä–∂–∫–∞
