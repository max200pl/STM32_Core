# Підключення 2х TB6612FNG до Black Pill

## Огляд

Цей проект використовує **2 модулі TB6612FNG** для керування **4 моторами**:

- **Driver 1**: Мотори 0 і 1
- **Driver 2**: Мотори 2 і 3

## 📌 Повна таблиця підключень

### Driver 1 (Мотори 0 і 1)

| TB6612FNG Pin | Black Pill Pin | Функція | Примітка |
|---------------|----------------|---------|----------|
| **PWMA** | PB0 | TIM3_CH3 | PWM для швидкості мотора 0 |
| **AIN1** | PB1 | GPIO | Напрямок мотора 0 |
| **AIN2** | PB10 | GPIO | Напрямок мотора 0 |
| **STBY** | PB11 | GPIO | Увімкнення/вимкнення Driver 1 |
| **BIN1** | PB12 | GPIO | Напрямок мотора 1 |
| **BIN2** | PB13 | GPIO | Напрямок мотора 1 |
| **PWMB** | PB7 | TIM4_CH2 | PWM для швидкості мотора 1 |
| **VCC** | 3V3 | Power | Живлення логіки (3.3V) |
| **GND** | GND | Ground | Земля |
| **VM** | 6-12V | Power | Зовнішнє живлення моторів ⚠️ |

### Driver 2 (Мотори 2 і 3)

| TB6612FNG Pin | Black Pill Pin | Функція | Примітка |
|---------------|----------------|---------|----------|
| **PWMA** | PA8 | TIM1_CH1 | PWM для швидкості мотора 2 |
| **AIN1** | PA0 | GPIO | Напрямок мотора 2 |
| **AIN2** | PA1 | GPIO | Напрямок мотора 2 |
| **STBY** | PA4 | GPIO | Увімкнення/вимкнення Driver 2 |
| **BIN1** | PA2 | GPIO | Напрямок мотора 3 |
| **BIN2** | PA3 | GPIO | Напрямок мотора 3 |
| **PWMB** | PA15 | TIM2_CH1 | PWM для швидкості мотора 3 |
| **VCC** | 3V3 | Power | Живлення логіки (3.3V) |
| **GND** | GND | Ground | Земля |
| **VM** | 6-12V | Power | Зовнішнє живлення моторів ⚠️ |

## 🔌 Схема підключення

```
┌──────────────────────────────────────────────────────────────┐
│                     Black Pill STM32F411                      │
│                                                                │
│  PB0──────┐      PB7──────┐      PA8──────┐      PA15─────┐  │
│  PB1──┐   │      PB12─┐   │      PA0──┐   │      PA2───┐   │  │
│  PB10─┤   │      PB13─┤   │      PA1──┤   │      PA3───┤   │  │
│  PB11─┼───┼───┐  ─────┤   │      PA4──┼───┼───┐  ──────┤   │  │
│  3V3──┼───┼───┼────────┼───┼────────────┼───┼───┼────────┼───┼──│
│  GND──┼───┼───┼────────┼───┼────────────┼───┼───┼────────┼───┼──│
└───────┼───┼───┼────────┼───┼────────────┼───┼───┼────────┼───┼──┘
        │   │   │        │   │            │   │   │        │   │
      ┌─┴───┴───┴───┐  ┌─┴───┴───┐      ┌─┴───┴───┴───┐  ┌─┴───┴───┐
      │ TB6612FNG   │  │ Motor 0 │      │ TB6612FNG   │  │ Motor 2 │
      │  Driver 1   │  │         │      │  Driver 2   │  │         │
      │             │  │ Motor 1 │      │             │  │ Motor 3 │
      │ PWMA  AIN1  │  └─────────┘      │ PWMA  AIN1  │  └─────────┘
      │ AIN2  STBY  │                   │ AIN2  STBY  │
      │ BIN1  BIN2  │                   │ BIN1  BIN2  │
      │ PWMB  VCC   │                   │ PWMB  VCC   │
      │ GND   VM    │                   │ GND   VM    │
      └──────┬──────┘                   └──────┬──────┘
             │                                  │
             └──────────┬───────────────────────┘
                        │
                   [6-12V External]
                   Power Supply
                   (Спільне живлення для обох драйверів)
```

## ⚡ Живлення

### Логіка (VCC)

- **Джерело**: 3V3 від Black Pill
- **Напруга**: 3.3V
- **Призначення**: Керування логікою драйверів

### Мотори (VM)

- **Джерело**: Зовнішній блок живлення (акумулятор, адаптер)
- **Напруга**: 6-12V (залежить від моторів)
- **Призначення**: Живлення моторів

### ⚠️ ВАЖЛИВО

1. **НЕ живіть мотори від USB або Black Pill!**
2. **Обов'язково з'єднайте GND** Black Pill та зовнішнього живлення
3. Використовуйте окремий блок живлення для VM

```
Правильне підключення живлення:

Black Pill (USB)  →  3V3  →  VCC (Driver 1 + Driver 2)
                     GND  →  GND (Driver 1 + Driver 2)

External Power    →  VM   →  VM (Driver 1 + Driver 2)
(6-12V Battery)      GND  →  GND (Driver 1 + Driver 2)
                              ↓
                          GND Black Pill
```

## 🎯 Використані таймери

| Таймер | Канал | Пін | Мотор | Частота PWM |
|--------|-------|-----|-------|-------------|
| TIM3 | CH3 | PB0 | Motor 0 | 1 kHz |
| TIM4 | CH2 | PB7 | Motor 1 | 1 kHz |
| TIM1 | CH1 | PA8 | Motor 2 | 1 kHz |
| TIM2 | CH1 | PA15 | Motor 3 | 1 kHz |

### Налаштування PWM

```c
Prescaler: 96 - 1   // 96 MHz / 96 = 1 MHz
Period: 1000 - 1    // 1 MHz / 1000 = 1 kHz PWM
```

## 💻 Використання коду

### 1. Базова ініціалізація

```c
#include "tb6612fng.h"

// Timer handles
TIM_HandleTypeDef htim1;  // Motor 2
TIM_HandleTypeDef htim2;  // Motor 3
TIM_HandleTypeDef htim3;  // Motor 0
TIM_HandleTypeDef htim4;  // Motor 1

int main(void) {
    HAL_Init();
    SystemClock_Config();

    // Initialize timers
    MX_TIM1_Init();
    MX_TIM2_Init();
    MX_TIM3_Init();
    MX_TIM4_Init();

    // Initialize motor drivers
    TB6612FNG_Init(&htim3, &htim4, &htim1, &htim2);

    // Enable all drivers
    TB6612FNG_EnableAll();

    // Тепер можна керувати моторами!
}
```

### 2. Керування окремим мотором

```c
// Motor 0: вперед на 70% швидкості
TB6612FNG_Drive(MOTOR_0, MOTOR_FORWARD, 70);
HAL_Delay(2000);

// Motor 1: назад на 50% швидкості
TB6612FNG_Drive(MOTOR_1, MOTOR_REVERSE, 50);
HAL_Delay(2000);

// Зупинити Motor 0
TB6612FNG_Stop(MOTOR_0);

// Екстрене гальмування Motor 1
TB6612FNG_Brake(MOTOR_1);
```

### 3. Керування всіма моторами

```c
// Всі мотори вперед
TB6612FNG_MoveForward(80);
HAL_Delay(2000);

// Всі мотори назад
TB6612FNG_MoveBackward(80);
HAL_Delay(2000);

// Зупинити всі
TB6612FNG_StopAll();
```

### 4. Повороти (для робота)

```c
// Поворот ліворуч (ліві колеса повільніші)
TB6612FNG_TurnLeft(70, 50);  // швидкість 70%, гострота 50%
HAL_Delay(1000);

// Поворот праворуч
TB6612FNG_TurnRight(70, 50);
HAL_Delay(1000);

// Обертання на місці ліворуч (танк)
TB6612FNG_RotateLeft(60);
HAL_Delay(1000);

// Обертання на місці праворуч
TB6612FNG_RotateRight(60);
HAL_Delay(1000);
```

### 5. Увімкнення/вимкнення драйверів

```c
// Увімкнути лише Driver 1 (мотори 0, 1)
TB6612FNG_EnableDriver1();

// Вимкнути Driver 2 (мотори 2, 3) - режим standby
TB6612FNG_DisableDriver2();

// Увімкнути всі драйвери
TB6612FNG_EnableAll();

// Вимкнути всі (економія енергії)
TB6612FNG_DisableAll();
```

## 🤖 Приклад руху робота (4 колеса)

Припустимо розташування моторів:

```
Motor 0 (передній лівий)    Motor 1 (передній правий)
         ●─────────────────────●
         │                     │
         │       Robot         │
         │                     │
         ●─────────────────────●
Motor 2 (задній лівий)      Motor 3 (задній правий)
```

### Рух вперед

```c
TB6612FNG_MoveForward(80);  // Всі 4 колеса вперед
```

### Поворот ліворуч з рухом

```c
// Ліві колеса (0, 2) - 40% швидкості
// Праві колеса (1, 3) - 80% швидкості
TB6612FNG_TurnLeft(80, 50);
```

### Обертання на місці праворуч

```c
// Ліві колеса (0, 2) - вперед
// Праві колеса (1, 3) - назад
TB6612FNG_RotateRight(60);
```

## 📝 API Функції

| Функція | Опис |
|---------|------|
| `TB6612FNG_Init()` | Ініціалізація драйверів |
| `TB6612FNG_EnableAll()` | Увімкнути всі драйвери |
| `TB6612FNG_DisableAll()` | Вимкнути всі драйвери |
| `TB6612FNG_Drive()` | Керування одним мотором |
| `TB6612FNG_Stop()` | Зупинити один мотор |
| `TB6612FNG_StopAll()` | Зупинити всі мотори |
| `TB6612FNG_Brake()` | Екстрене гальмування |
| `TB6612FNG_MoveForward()` | Рух вперед (всі мотори) |
| `TB6612FNG_MoveBackward()` | Рух назад (всі мотори) |
| `TB6612FNG_TurnLeft()` | Поворот ліворуч |
| `TB6612FNG_TurnRight()` | Поворот праворуч |
| `TB6612FNG_RotateLeft()` | Обертання ліворуч на місці |
| `TB6612FNG_RotateRight()` | Обертання праворуч на місці |

## 🔧 Налаштування проекту

### platformio.ini

Переконайтеся, що у вас правильні налаштування:

```ini
[env:blackpill_f411ce]
platform = ststm32
board = blackpill_f411ce
framework = stm32cube

upload_protocol = stlink
debug_tool = stlink

build_flags =
    -D HSE_VALUE=25000000
    -D USE_HAL_DRIVER
    -D STM32F411xE
```

### Файли проекту

```
STM32_Core/
├── src/
│   ├── main.c              - Ваш основний код
│   ├── tb6612fng.h         - Заголовочний файл драйвера
│   ├── tb6612fng.c         - Реалізація драйвера
│   └── main_motors_example.c - Приклад використання
├── include/
└── learning/
    └── TB6612FNG_Dual_Connection_Guide.md (цей файл)
```

### Копіювання прикладу в main.c

```bash
# Скопіюйте код з прикладу
cp src/main_motors_example.c src/main.c
```

## ⚠️ Важливі застереження

### 🔴 НЕ робіть цього

1. ❌ Не живіть мотори від USB
2. ❌ Не використовуйте PA13, PA14 (SWD pins!)
3. ❌ Не забувайте з'єднати GND
4. ❌ Не перевищуйте 3.6V на пінах Black Pill
5. ❌ Не підключайте VM більше 15V

### ✅ Робіть це

1. ✅ Використовуйте окреме живлення для VM (6-12V)
2. ✅ З'єднайте GND Black Pill та зовнішнього живлення
3. ✅ Перевірте полярність моторів перед запуском
4. ✅ Почніть з малої швидкості (30-40%) для тестування
5. ✅ Додайте конденсатор 100-1000µF на VM для стабільності

## 🛠️ Діагностика проблем

| Проблема | Рішення |
|----------|---------|
| Мотори не крутяться | Перевірте STBY=HIGH, VM живлення, з'єднання GND |
| Один мотор не працює | Перевірте провода, PWM timer, напрямок пінів |
| Мотори крутяться слабко | Збільште напругу VM (до 12V), перевірте струм |
| Програма не завантажується | Не використовуйте PA13/PA14 у коді! |
| Хаотична поведінка | Додайте конденсатор на VM, з'єднайте GND |

## 📚 Додаткові ресурси

- [TB6612FNG_MotorDriver_Datasheet.md](TB6612FNG_MotorDriver_Datasheet.md) - Повна документація одного драйвера
- [STM32F411_BlackPill_Datasheet.md](STM32F411_BlackPill_Datasheet.md) - Повний pinout Black Pill
- [01_project_structure.md](01_project_structure.md) - Структура проекту

## 🎉 Готово

Тепер ви можете керувати 4 моторами за допомогою 2 драйверів TB6612FNG!

**Наступні кроки:**

- Додайте датчики (ультразвуковий, інфрачервоний)
- Реалізуйте автономну навігацію
- Додайте енкодери для точного керування
- Створіть бібліотеку рухів робота
